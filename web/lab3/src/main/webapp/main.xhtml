<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">
<h:head>
    <title>Geometry Check</title>    
</h:head>
<h:body>
    <h:form id="pointForm">
        <h:inputHidden id="hiddenX" value="#{pointBean.hiddenX}" />
        <h:inputHidden id="hiddenY" value="#{pointBean.hiddenY}" />        

        <h:outputLabel for="x" value="Select X:"/>
        <h:selectOneMenu id="x" value="#{pointBean.x}">
            <f:selectItem itemValue="-3" itemLabel="-3"/>
            <f:selectItem itemValue="-2" itemLabel="-2"/>
            <f:selectItem itemValue="-1" itemLabel="-1"/>
            <f:selectItem itemValue="0" itemLabel="0"/>
            <f:selectItem itemValue="1" itemLabel="1"/>
            <f:selectItem itemValue="2" itemLabel="2"/>
            <f:selectItem itemValue="3" itemLabel="3"/>
            <f:selectItem itemValue="4" itemLabel="4"/>
        </h:selectOneMenu>

        <h:outputLabel for="y" value="Enter Y:"/>
        <h:inputText id="y" value="#{pointBean.y}" required="true"/>

        <h:outputLabel for="r" value="Select R:"/>
        <h:selectOneRadio id="r" value="#{pointBean.r}"> 
            <f:selectItem itemValue="1" itemLabel="1"/>
            <f:selectItem itemValue="2" itemLabel="2"/>
            <f:selectItem itemValue="3" itemLabel="3"/>
            <f:selectItem itemValue="4" itemLabel="4"/>
        </h:selectOneRadio>

        <h:outputText value="Results:"/>
        <h:dataTable id="resultsTable" value="#{pointBean.points}" var="point">
            <h:column>
                <f:facet name="header">X</f:facet>
                #{point.x}
            </h:column>
            <h:column>
                <f:facet name="header">Y</f:facet>
                #{point.y}
            </h:column>
            <h:column>
                <f:facet name="header">R</f:facet>
                #{point.r}
            </h:column>
            <h:column>
                <f:facet name="header">Result</f:facet>
                #{point.result ? 'Hit' : 'Miss'}
            </h:column>
        </h:dataTable>


        <h:commandButton id="checkButton" value="Check" action="#{pointBean.addPointFromInput}">
            <f:ajax execute="@form" render="resultsTable graphSvg"/>
        </h:commandButton>


    </h:form>

    <h:form id="tableForm">
        <div class="graph" id="graph">
            <svg id="graphSvg" xmlns="http://www.w3.org/2000/svg" width="400px" height="400px">
                <!-- Оси -->
                <line x1="0" y1="200" x2="400" y2="200" stroke="#000720"></line>
                <line x1="200" y1="0" x2="200" y2="400" stroke="#000720"></line>

                <!-- Метки по оси Y -->
                <line x1="195" y1="30" x2="205" y2="30" stroke="black" stroke-width="2"></line>
                <text x="210" y="35" font-size="12" fill="black" id="labelR">R</text>

                <line x1="195" y1="115" x2="205" y2="115" stroke="black" stroke-width="2"></line>
                <text x="210" y="120" font-size="12" fill="black" id="labelR2">R/2</text>

                <line x1="195" y1="285" x2="205" y2="285" stroke="black" stroke-width="2"></line>
                <text x="210" y="290" font-size="12" fill="black" id="labelNegR2">-R/2</text>

                <line x1="195" y1="370" x2="205" y2="370" stroke="black" stroke-width="2"></line>
                <text x="210" y="375" font-size="12" fill="black" id="labelNegR">-R</text>

                <!-- Метки по оси X -->
                <line x1="30" y1="195" x2="30" y2="205" stroke="black" stroke-width="2"></line>
                <text x="20" y="190" font-size="12" fill="black">-R</text>

                <line x1="115" y1="195" x2="115" y2="205" stroke="black" stroke-width="2"></line>
                <text x="105" y="190" font-size="12" fill="black">-R/2</text>

                <line x1="285" y1="195" x2="285" y2="205" stroke="black" stroke-width="2"></line>
                <text x="275" y="190" font-size="12" fill="black">R/2</text>

                <line x1="370" y1="195" x2="370" y2="205" stroke="black" stroke-width="2"></line>
                <text x="360" y="190" font-size="12" fill="black">R</text>

                <!-- Прямоугольник (вторая четверть) -->
                <rect id="rectangle" x="200" y="115" width="170" height="85" fill-opacity="0.4" stroke="navy" fill="blue"></rect>

                <!-- Треугольник (третья четверть) -->
                <polygon id="triangle" points="200,200 200,370 30,200" fill-opacity="0.4" stroke="navy" fill="blue"></polygon>

                <!-- Четверть круга (четвертая четверть) -->
                <path id="circleQuarter" d="M 200 200 L 285 200 A 85 85 0 0 1 200 285 Z" fill-opacity="0.4" stroke="navy" fill="blue"></path>

                <h:outputText escape="false" value="#{pointBean.pointsAsSvg}" />
            </svg>
        </div>
    </h:form>

    <h:form id="svg-form">
        <h:inputHidden id="xValue" value="#{pointBean.x}"/>
        <h:inputHidden id="yValue" value="#{pointBean.y}"/>
        <h:inputHidden id="rValue" value="#{pointBean.r}"/>
        
        <!-- Передаем полный clientId формы в JavaScript переменную -->
        <h:outputText id="hiddenClientId" value="#{component.clientId}" style="display:none" />
        <script type="text/javascript">
            // Получаем полный clientId формы
            const svgFormId = "#{component.clientId}";
        </script>
    
        <h:commandButton id="svgClickButton" styleClass="hidden">
            <f:ajax execute="@form"
                    listener="#{pointBean.checkAndAddPoint}"
                    render="pointForm:resultsTable graphSvg"/>
        </h:commandButton>
    </h:form>
    
    

    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            const svgElement = document.getElementById("graphSvg"); // ID вашего SVG элемента

            svgElement.addEventListener("click", function (event) {
                const rect = svgElement.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                // Используем точное значение name для получения выбранного R
                const selectedRInput = document.querySelector("input[name='pointForm:r']:checked");
                const selectedR = selectedRInput ? selectedRInput.value : null;

                // Проверяем, выбрано ли значение R
                if (selectedR === null) {
                    alert("Please select a value for R before clicking on the SVG.");
                    return;
                }

                // Устанавливаем значения скрытых полей
                document.getElementById(svgFormId + ":xValue").value = x;
                document.getElementById(svgFormId + ":yValue").value = y;
                document.getElementById(svgFormId + ":rValue").value = selectedR;

                // Программно кликаем на скрытую кнопку
                document.getElementById(svgFormId + ":svgClickButton").click();
            });
        });
    </script>
    
    
    
</h:body>
</html>
